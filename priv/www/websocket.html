<!DOCTYPE HTML>
<html>
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>Overview - Emqttd Dashboard</title>
<!-- The Fonts -->
<!-- <link href="http://fonts.googleapis.com/css?family=Oswald|Droid+Sans:400,700" rel="stylesheet" /> -->
<!-- The Main CSS File -->
<link rel="stylesheet" href="css/style.css" />
<script src="script/jQuery/jquery-1.7.2.min.js"></script>
<script src="script/jQueryUI/jquery-ui-1.8.21.min.js"></script>
<script src="script/emqttd.js"></script>
<script src="res/javascript/mqttws31.js"></script>
<script type="text/javascript">
	$(document).ready(function() {
		addClick();
		if (!window.WebSocket) {
			alert("WebSocket not supported by this browser.");
		}

		$('#connect_btn').click(function() {
			connect();
		});

		$('#send_btn').click(function() {
			var msg = jQuery('#message').val();
			sendMessage(msg);
		});
	});

	// Create a client instance
	var client = new Paho.MQTT.Client(location.hostname, 8083, "clientId");

	// set callback handlers
	client.onConnectionLost = onConnectionLost;
	client.onMessageArrived = onMessageArrived;

	// called when the client loses its connection
	function onConnectionLost(responseObject) {
		if (responseObject.errorCode !== 0) {
			console.log("onConnectionLost:" + responseObject.errorMessage);
		}
	}

	// called when a message arrives
	function onMessageArrived(message) {
		console.log("onMessageArrived:" + message.payloadString);
	}

	// the client connect
	function connect() {
		client.connect({
			onSuccess : function() {
				jQuery('#conn_state').text('CONNECTED');
				console.log("The client connect success.");
				client.subscribe("/World");

				sendMessage("Hello")
			}
		});
	}

	// the client send message
	function sendMessage(msg) {
		var message = new Paho.MQTT.Message(msg);
		message.destinationName = "/World";
		client.send(message);
	}
</script>
</head>
<body>
	<!-- Top Panel -->
	<header class="top-panel">
		<div class="wrapper">
			<div class="logo">
				<a href="#" title="Emqtt Home"> <img src="imgs/emqtt_logo.png"
					alt="emqtt_logo" height="60px;" />
				</a>
			</div>
		</div>
	</header>

	<aside class="sidebar">
		<nav>
			<ul class="main-tab-nav" id="tab_nav">
				<li class="active-tab"><a href="#" title="General">Overview</a></li>
				<li class=""><a href="#" title="Clients">Clients</a></li>
				<li class=""><a href="#" title="Session">Session</a></li>
				<li class=""><a href="#" title="Topic">Topic</a></li>
				<li class=""><a href="#" title="Subpub">Subpub</a></li>
				<li class=""><a href="websocket.html" title="Websocket">Websocket</a></li>
			</ul>
		</nav>
	</aside>

	<div class="wrapper contents-wrapper" id="page">

		<div class="contents" id="contents">
			<div>
				<h1 class="h1">MQTT Over websocket</h1>
				<p>&nbsp;</p>
				<!-- col -->
				<div class="colgroup leading full">
					<div class="column full first">
						<h3 class="h3">Connect State</h3>
						<hr />
						<div>
							<label>Current State: <b id="conn_state">DISCONNECT</b></label>
							<a id="connect_btn" href="javascript:void();" class="btn">Connect</a>
						</div>
					</div>
				</div>
				<!-- col -->
				<div class="colgroup leading full">
					<div class="column full first">
						<h3 class="h3">Connect State</h3>
						<hr />
						<div>
							<input type="text" name="message" id="message" /> <a
								href="javascript:void();" class="btn" id="send_btn">Send</a>
						</div>
					</div>
				</div>
			</div>
		</div>
		<div class="clear"></div>

	</div>

	<!-- 
	<footer>
		<div class="wrapper">
			<span class="copyright"> &copy; Copyright &copy; 2015.Company
				<a target="_blank" href="http://emqtt.io">emqtt.io</a> All rights
				reserved.
			</span>
		</div>
	</footer>
	 -->
</body>
</html>